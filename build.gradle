plugins {
  id "java"
  id "org.jetbrains.intellij" version "1.3.1"
  id "pl.allegro.tech.build.axion-release" version "1.9.3"
}

group "net.ashald"

scmVersion {
  tag {
    prefix = "v"
    versionSeparator = ""
  }
}

allprojects {
  repositories {
    mavenCentral()
  }
  project.version = scmVersion.version

  ext.jetbrains = [
      version : "2021.3.2",
      pycharm : "PythonCore:213.6461.82",
      rubymine: "org.jetbrains.plugins.ruby:213.6461.79",
      goland  : "org.jetbrains.plugins.go:213.6461.48",
      scala   : "org.intellij.scala:2021.3.17",
      webstorm   : "JavaScript"
  ]
  buildSearchableOptions {
      enabled = false
  }
}

intellij {
  type = "IU"
  version = jetbrains.version
  pluginName = "EnvFile"
  sameSinceUntilBuild = false
  updateSinceUntilBuild = false
  plugins = ['java']
}

buildSearchableOptions {
    enabled = false
}

dependencies {
  implementation project(":envfile-products-idea")
  implementation project(":envfile-products-pycharm")
  implementation project(":envfile-products-rubymine")
  implementation project(":envfile-products-goland")
//  implementation project(":envfile-products-webstorm")
}

wrapper {
  gradleVersion = "7.4"
}

logger.lifecycle("FOO: ${System.getenv("FOO")}")
logger.lifecycle("BAR: ${System.getenv("BAR")}")
//def prj = ".idea/"
//
//idea {
//  module.iml {
//    generateTo = file(prj)
//
//    withXml {
//      it.node.@type = "PLUGIN_MODULE"
//      it.node.appendNode('component', [name: 'DevKit.ModuleBuildProperties', url: 'file://$MODULE_DIR$/src/main/resources/META-INF/plugin.xml'])
//    }
//  }
//}
//
//task setup {
//  dependsOn ideaModule, ideaProject
//  // overriding idea.project.outputFile changes relative path calculation so it's easier to just move a file
//  doLast {
//    copy {
//      from '.'
//      into prj
//      include "${project.name}.ipr"
//      rename { "modules.xml" }
//    }
//    project.delete "${project.name}.ipr"
//  }
//}
